{% extends "domain_base.html" %}
{% load static field_helpers url_helpers %}

{% block title %}DS Data | {{ domain.name }} | {% endblock %}

{% block domain_content %}

  <h1>DS Data</h1>

  {% if domain.dnssecdata is not None and domain.dnssecdata.keyData is not None %}
  <div class="usa-alert usa-alert--warning usa-alert--slim margin-bottom-3">
    <div class="usa-alert__body">
      <h4 class="usa-alert__heading">Warning, you cannot add DS Data</h4>
      <p class="usa-alert__text">
        You cannot add DS Data because you have already added Key Data. Delete your Key Data records in order to add DS Data.
      </p>
    </div>
  </div>
  {% elif not domain.dnssec_ds_confirmed %}
    <p>In order to enable DNSSEC and add DS records, you must first configure it with your DNS hosting service. Your configuration will determine whether you need to add DS Data or Key Data. Contact your DNS hosting provider if you are unsure which record type to add.</p>
    <form class="usa-form usa-form--large" method="post" novalidate id="form-container">
      {% csrf_token %}
      <button
        type="submit"
        class="usa-button"
        name="confirm-ds"
        >Add DS Data record</button>
    </form>
  {% else %}
  {% include "includes/required_fields.html" %}

  <form class="usa-form usa-form--extra-large" method="post" novalidate id="form-container">
    {% csrf_token %}
    {{ formset.management_form }}

    {% for form in formset %}
    <fieldset class="ds-record">

      <legend>DS Data record {{forloop.counter}}</legend>

      <div class="grid-row grid-gap-2">
        <div class="tablet:grid-col-4">
          {% with attr_required=True %}
            {% input_with_errors form.key_tag %}
          {% endwith %}
        </div>
        <div class="tablet:grid-col-4">
          {% with attr_required=True %}
            {% input_with_errors form.algorithm %}
          {% endwith %}
        </div>
        <div class="tablet:grid-col-4">
          {% with attr_required=True %}
            {% input_with_errors form.digest_type %}
          {% endwith %}
        </div>
      </div>

      <div class="grid-row">
        <div class="grid-col">
          {% with attr_required=True %}
            {% input_with_errors form.digest %}
          {% endwith %}
        </div>
      </div>

      <div class="grid-row margin-top-2">
        <div class="grid-col">
          {% with add_group_class="float-right-tablet" %}
            {% input_with_errors form.delete %}
          {% endwith %}
        </div>
      </div>

    </fieldset>
    {% endfor %}

    <button type="button" class="usa-button usa-button--unstyled display-block" id="add-form2">
      <svg class="usa-icon" aria-hidden="true" focusable="false" role="img" width="24" height="24">
        <use xlink:href="{%static 'img/sprite.svg'%}#add_circle"></use>
      </svg><span class="margin-left-05">Add new record</span>
    </button>

    <button
          type="submit"
          class="usa-button"
      >Save
    </button>
  </form>
  {% endif %}
{% endblock %}  {# domain_content #}
